# show many fmt bugs: run with `testscript -continue fmt-issues.txtar` (0.070s)
> force-verbose
FAIL: /var/folders/3_/1_3zy7k92qndm5jfysbdrkrr0000gn/T/testscript3740367828/fmt-issues.txtar/script.txtar:2: unknown command "force-verbose"
> env CUEDO_FMT_DEBUGSTR=1
> exec cue version
[stdout]
cue version v0.0.0-20231118133415-b3a417b28fad

go version go1.21.0
      -buildmode exe
       -compiler gc
  DefaultGODEBUG panicnil=1
     CGO_ENABLED 1
          GOARCH amd64
            GOOS darwin
         GOAMD64 v1
             vcs git
    vcs.revision b3a417b28fad23eec87bda1cf90a6278506761b1
        vcs.time 2023-11-18T13:34:15Z
    vcs.modified true
#
# issue #720 ---------------------------------------------- (0.072s)
> exec cat 720B.cue
[stdout]
import "encoding/base64"

// comment

#A: {}
> exec cue fmt 720B.cue    ### fmt hoists the comment into the import block
[stderr]
file: 720B.cue decoded ast DebugStr:import <[2// comment] "encoding/base64">, #A: {}
> exec cat 720B.cue
[stdout]
import ( "encoding/base64"

	// comment
)

#A: {}
> exec cue vet 720B.cue    ### vet passes nevertheless
> cmp expected/720B.cue 720B.cue
diff expected/720B.cue 720B.cue
--- expected/720B.cue
+++ 720B.cue
@@ -1,6 +1,6 @@
-import "encoding/base64"
-
-// comment
+import ( "encoding/base64"
+
+	// comment
+)
 
 #A: {}
-

FAIL: /var/folders/3_/1_3zy7k92qndm5jfysbdrkrr0000gn/T/testscript3740367828/fmt-issues.txtar/script.txtar:12: expected/720B.cue and 720B.cue differ
#
# issue #1447 is a duplicate of #720 ----------------------
#
# issue #2274 --------------------------------------------- (0.104s)
> exec cat 2274B.cue
[stdout]
#Number: two: 2

aList: [
  1,
  #Number.two,
  // comment

  3,
]
> exec cue vet 2274B.cue
> exec cue fmt 2274B.cue    ### fmt misplaces comma onto the comment line
[stderr]
file: 2274B.cue decoded ast DebugStr:#Number: {two: 2}, aList: [1, <[3// comment] #Number.two>, 3]
> exec cat 2274B.cue
[stdout]
#Number: two: 2

aList: [
	1,
	#Number.two
	// comment,

	3,
]
> exec cue vet 2274B.cue    ### vet fails
[stderr]
missing ',' before newline in list literal:
    ./2274B.cue:8:2
missing ',' in list literal:
    ./2274B.cue:9:3
[exit status 1]
FAIL: /var/folders/3_/1_3zy7k92qndm5jfysbdrkrr0000gn/T/testscript3740367828/fmt-issues.txtar/script.txtar:23: unexpected command failure
#
# issue #2423 --------------------------------------------- (0.196s)
> exec cat 2423.cue
[stdout]
#X: {a?: int}

foo: #X & {
  // a: 5
}
> exec cue vet 2423.cue
> exec cue fmt 2423.cue     ### fmt misplaces a comment line
[stderr]
file: 2423.cue decoded ast DebugStr:#X: {a?: int}, foo: <[d1// a: 5] #X&{}>
> exec cat 2423.cue
[stdout]
#X: {a?: int}

foo: #X
	// a: 5
	& {
	}
> exec cue vet 2423.cue     ### vet fails
[stderr]
expected operand, found '&':
    ./2423.cue:5:2
[exit status 1]
FAIL: /var/folders/3_/1_3zy7k92qndm5jfysbdrkrr0000gn/T/testscript3740367828/fmt-issues.txtar/script.txtar:31: unexpected command failure
> exec cat 2423-2.cue
[stdout]
example: {} & {
    // This is a comment
}
> exec cue vet 2423-2.cue
> exec cue fmt 2423-2.cue   ### fmt misplaces a comment line
[stderr]
file: 2423-2.cue decoded ast DebugStr:example: <[d1// This is a comment] {}&{}>
> exec cat 2423-2.cue
[stdout]
example: {}
	// This is a comment
	& {
	}
> exec cue vet 2423-2.cue   ### vet fails
[stderr]
expected operand, found '&':
    ./2423-2.cue:3:2
[exit status 1]
FAIL: /var/folders/3_/1_3zy7k92qndm5jfysbdrkrr0000gn/T/testscript3740367828/fmt-issues.txtar/script.txtar:37: unexpected command failure
#
# issue #2567 --------------------------------------------- (0.182s)
> exec cat 2567.cue
[stdout]
foo: [
	bar["baz"], //some comment
]
bar: baz: 43
> exec cue vet 2567.cue
> exec cue fmt 2567.cue     ### fmt misplaces the comment inside the brackets
[stderr]
file: 2567.cue decoded ast DebugStr:foo: [<[l3//some comment] bar["baz"]>], bar: {baz: 43}
> exec cat 2567.cue
[stdout]
foo: [
	bar["baz" //some comment],
]
bar: baz: 43
> exec cue vet 2567.cue     ### vet fails
[stderr]
expected ']', found newline:
    ./2567.cue:2:12
[exit status 1]
FAIL: /var/folders/3_/1_3zy7k92qndm5jfysbdrkrr0000gn/T/testscript3740367828/fmt-issues.txtar/script.txtar:45: unexpected command failure
> exec cat 2567-2.cue
[stdout]
[
	if true // inline comment
	{}]
> exec cue vet 2567-2.cue
> exec cue fmt 2567-2.cue   ### fmt misplaces the comment inside the brackets
[stderr]
file: 2567-2.cue decoded ast DebugStr:[<[l2// inline comment] if true {}>]
> exec cat 2567-2.cue
[stdout]
[
	if true {} // inline comment]
> exec cue vet 2567-2.cue   ### vet fails
[stderr]
expected ']', found 'EOF':
    ./2567-2.cue:2:32
[exit status 1]
FAIL: /var/folders/3_/1_3zy7k92qndm5jfysbdrkrr0000gn/T/testscript3740367828/fmt-issues.txtar/script.txtar:51: unexpected command failure
#
# files --------------------------------------------------- (0.000s)
